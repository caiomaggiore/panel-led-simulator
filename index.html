<!DOCTYPE html>
<html>
<head>
    <title>Simulador CAVE - Simplificado</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div id="container"></div>
    
    <!-- Seletor de Modo (topo direito) -->
    <div id="work-mode-selector">
        <button class="work-mode-btn active" onclick="setWorkMode('preview3d')">
            <i class="fas fa-cube"></i>
            <span>Preview 3D</span>
        </button>
        <button class="work-mode-btn" onclick="setWorkMode('uv-editor')">
            <i class="fas fa-edit"></i>
            <span>Editor UV</span>
        </button>
    </div>
    
    <!-- Editor UV (ocupará tela inteira quando ativo) -->
    <div id="uv-editor-fullscreen">
        <div class="uv-editor-container">
            <!-- PIP Preview 3D -->
            <div id="pip-preview">
                <div id="pip-3d-container"></div>
                <div class="pip-controls">
                    <button class="pip-btn" onclick="togglePIP()">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
            
            <!-- Menu de Controles UV (abaixo do PIP) -->
            <div id="uv-controls-panel">
                <h4>CONTROLES UV</h4>
                <div class="uv-control-group">
                    <label>Resolução:</label>
                    <select id="uv-grid-resolution" onchange="updateGridResolution()">
                        <option value="2">2x2</option>
                        <option value="3">3x3</option>
                        <option value="5" selected>5x5</option>
                    </select>
                </div>
                <div class="uv-control-group">
                    <button class="uv-control-btn" onclick="toggleInfluenceMode()">
                        <i class="fas fa-bullseye"></i> <span id="influence-btn-text">Influência ON</span>
                    </button>
                </div>
                <div class="uv-control-group">
                    <label>Raio:</label>
                    <select id="uv-influence-radius" onchange="updateInfluenceRadius()">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </div>
                <div class="uv-control-group">
                    <label>Intensidade:</label>
                    <select id="uv-influence-strength" onchange="updateInfluenceStrength()">
                        <option value="0.25">Fraco</option>
                        <option value="0.50" selected>Médio</option>
                        <option value="0.75">Forte</option>
                    </select>
                </div>
                <div class="uv-control-group">
                    <button class="uv-control-btn primary" onclick="resetUVGrid()">
                        <i class="fas fa-undo"></i> Reset Grade
                    </button>
                </div>
                <div class="uv-control-group">
                    <button class="uv-control-btn success" onclick="applyDistortionToFloor()">
                        <i class="fas fa-check"></i> Aplicar ao Piso
                    </button>
                </div>
            </div>
            
            <!-- Editor Principal -->
            <div class="uv-main-editor">
                <div class="uv-editor-header">
                    <h2>EDITOR DE DISTORÇÃO UV</h2>
                </div>
                
                <div class="uv-editor-workspace">
                    <canvas id="uv-editor-canvas"></canvas>
                </div>
                
                <div class="uv-editor-footer">
                    <div class="uv-instructions">
                        <i class="fas fa-info-circle"></i>
                        <span>Arraste os pontos da grade para distorcer a textura. Use o PIP para ver o resultado em tempo real.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="controls">
        <div class="input-group">
            <label>Carregar Imagem:</label>
            <input type="text" id="image-url" placeholder="URL da imagem">
            <button id="load-btn">Carregar URL</button>
            <div class="file-input-wrapper">
                <label for="image-file" class="file-input-label">Escolher arquivo</label>
                <input type="file" id="image-file" accept="image/*">
                <span id="file-name"></span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="center">Painel Central</button>
            <button class="tab" data-tab="floor">Piso</button>
        </div>

        <div id="center-tab" class="tab-content active">
            <div class="sub-tabs">
                <button class="sub-tab active" data-subtab="center-position">POSIÇÃO</button>
                <button class="sub-tab" data-subtab="center-dimension">DIMENSÃO</button>
                <button class="sub-tab" data-subtab="center-texture">TEXTURA</button>
            </div>
            
            <div class="sub-tab-content active" id="center-position">
                <div class="slider-group">
                    <label>Posição X:</label>
                    <input type="range" id="center-position-x" min="-10" max="10" value="0" step="0.1">
                    <input type="number" id="center-position-x-number" value="0" step="0.1">
                    <span id="center-position-x-value">0</span>
                </div>
                <div class="slider-group">
                    <label>Posição Y:</label>
                    <input type="range" id="center-position-y" min="-10" max="10" value="0" step="0.1">
                    <input type="number" id="center-position-y-number" value="0" step="0.1">
                    <span id="center-position-y-value">0</span>
                </div>
                <div class="slider-group">
                    <label>Posição Z:</label>
                    <input type="range" id="center-position-z" min="-10" max="10" value="0" step="0.1">
                    <input type="number" id="center-position-z-number" value="0" step="0.1">
                    <span id="center-position-z-value">0</span>
                </div>
            </div>
            
            <div class="sub-tab-content" id="center-dimension">
                <div class="slider-group">
                    <label>Largura Total:</label>
                    <input type="range" id="center-width" min="1" max="20" value="10" step="0.1">
                    <input type="number" id="center-width-number" value="10" step="0.1">
                    <span id="center-width-value">10</span>
                </div>
                <div class="slider-group">
                    <label>Altura:</label>
                    <input type="range" id="center-height" min="1" max="20" value="3" step="0.1">
                    <input type="number" id="center-height-number" value="3" step="0.1">
                    <span id="center-height-value">3</span>
                </div>
                <div class="slider-group">
                    <label>Largura Lateral Esquerda:</label>
                    <input type="range" id="left-section-width" min="0" max="50" value="25" step="1">
                    <input type="number" id="left-section-width-number" value="25" step="1">
                    <span id="left-section-width-value">25%</span>
                </div>
                <div class="slider-group">
                    <label>Largura Lateral Direita:</label>
                    <input type="range" id="right-section-width" min="0" max="50" value="25" step="1">
                    <input type="number" id="right-section-width-number" value="25" step="1">
                    <span id="right-section-width-value">25%</span>
                </div>
                <div class="slider-group">
                    <label>Ângulo Esquerdo:</label>
                    <input type="range" id="left-angle" min="-90" max="90" value="0" step="1">
                    <input type="number" id="left-angle-number" value="0" step="1">
                    <span id="left-angle-value">0°</span>
                </div>
                <div class="slider-group">
                    <label>Ângulo Direito:</label>
                    <input type="range" id="right-angle" min="-90" max="90" value="0" step="1">
                    <input type="number" id="right-angle-number" value="0" step="1">
                    <span id="right-angle-value">0°</span>
                </div>
                <div class="slider-group">
                    <label>Raio da Curva:</label>
                    <input type="range" id="curve-radius" min="0" max="2" value="0.5" step="0.05">
                    <input type="number" id="curve-radius-number" value="0.5" step="0.05">
                    <span id="curve-radius-value">0.5</span>
                </div>
            </div>
            
            <div class="sub-tab-content" id="center-texture">
                <div class="slider-group">
                    <label>Cor:</label>
                    <input type="color" id="center-color" value="#333333">
                    <span id="center-color-value">#333333</span>
                </div>
                <div class="slider-group">
                    <label>Offset X:</label>
                    <input type="range" id="center-offset-x" min="-1" max="1" value="0" step="0.01">
                    <input type="number" id="center-offset-x-number" value="0" step="0.01">
                    <span id="center-offset-x-value">0</span>
                </div>
                <div class="slider-group">
                    <label>Offset Y:</label>
                    <input type="range" id="center-offset-y" min="-1" max="1" value="0" step="0.01">
                    <input type="number" id="center-offset-y-number" value="0" step="0.01">
                    <span id="center-offset-y-value">0</span>
                </div>
                <div class="slider-group">
                    <label>Escala X:</label>
                    <input type="range" id="center-scale-x" min="0.1" max="10" value="1" step="0.1">
                    <input type="number" id="center-scale-x-number" value="1" step="0.1">
                    <span id="center-scale-x-value">1</span>
                </div>
                <div class="slider-group">
                    <label>Escala Y:</label>
                    <input type="range" id="center-scale-y" min="0.1" max="10" value="1" step="0.1">
                    <input type="number" id="center-scale-y-number" value="1" step="0.1">
                    <span id="center-scale-y-value">1</span>
                </div>
            </div>
        </div>

        <div id="floor-tab" class="tab-content">
            <div class="sub-tabs">
                <button class="sub-tab active" data-subtab="floor-position">POSIÇÃO</button>
                <button class="sub-tab" data-subtab="floor-dimension">DIMENSÃO</button>
                <button class="sub-tab" data-subtab="floor-texture">TEXTURA</button>
            </div>
            
            <div class="sub-tab-content active" id="floor-position">
                <div class="slider-group">
                    <label>Posição X:</label>
                    <input type="range" id="floor-position-x" min="-10" max="10" value="0" step="0.1">
                    <input type="number" id="floor-position-x-number" value="0" step="0.1">
                    <span id="floor-position-x-value">0</span>
                </div>
                <div class="slider-group">
                    <label>Posição Y:</label>
                    <input type="range" id="floor-position-y" min="-10" max="10" value="0" step="0.1">
                    <input type="number" id="floor-position-y-number" value="0" step="0.1">
                    <span id="floor-position-y-value">0</span>
                </div>
                <div class="slider-group">
                    <label>Posição Z:</label>
                    <input type="range" id="floor-position-z" min="-10" max="10" value="0" step="0.1">
                    <input type="number" id="floor-position-z-number" value="0" step="0.1">
                    <span id="floor-position-z-value">0</span>
                </div>
            </div>
            
            <div class="sub-tab-content" id="floor-dimension">
                <div class="slider-group">
                    <label>Largura:</label>
                    <input type="range" id="floor-width" min="1" max="20" value="8" step="0.1">
                    <input type="number" id="floor-width-number" value="8" step="0.1">
                    <span id="floor-width-value">8</span>
                </div>
                <div class="slider-group">
                    <label>Profundidade:</label>
                    <input type="range" id="floor-depth" min="1" max="20" value="6" step="0.1">
                    <input type="number" id="floor-depth-number" value="6" step="0.1">
                    <span id="floor-depth-value">6</span>
                </div>
            </div>
            
            <div class="sub-tab-content" id="floor-texture">
                <div class="slider-group">
                    <label>Cor:</label>
                    <input type="color" id="floor-color" value="#333333">
                    <span id="floor-color-value">#333333</span>
                </div>
                <div class="slider-group">
                    <label>Offset X:</label>
                    <input type="range" id="floor-offset-x" min="-1" max="1" value="0" step="0.01">
                    <input type="number" id="floor-offset-x-number" value="0" step="0.01">
                    <span id="floor-offset-x-value">0</span>
                </div>
                <div class="slider-group">
                    <label>Offset Y:</label>
                    <input type="range" id="floor-offset-y" min="-1" max="1" value="0" step="0.01">
                    <input type="number" id="floor-offset-y-number" value="0" step="0.01">
                    <span id="floor-offset-y-value">0</span>
                </div>
                <div class="slider-group">
                    <label>Escala X:</label>
                    <input type="range" id="floor-scale-x" min="0.1" max="10" value="1" step="0.1">
                    <input type="number" id="floor-scale-x-number" value="1" step="0.1">
                    <span id="floor-scale-x-value">1</span>
                </div>
                <div class="slider-group">
                    <label>Escala Y:</label>
                    <input type="range" id="floor-scale-y" min="0.1" max="10" value="1" step="0.1">
                    <input type="number" id="floor-scale-y-number" value="1" step="0.1">
                    <span id="floor-scale-y-value">1</span>
                </div>
            </div>
        </div>

    </div>
    
    <div id="presets" class="preset-panel">
        <h3>PRESETS</h3>
        
        <!-- Abas do painel de presets -->
        <div class="preset-tabs">
            <button class="preset-tab active" onclick="showPresetTab('presets')">
                <i class="fas fa-th-large"></i>
            </button>
            <button class="preset-tab" onclick="showPresetTab('save')">
                <i class="fas fa-save"></i>
            </button>
            <button class="preset-tab" onclick="showPresetTab('tools')">
                <i class="fas fa-cog"></i>
            </button>
        </div>
        
        <!-- Conteúdo das abas -->
        <div id="preset-tab-presets" class="preset-tab-content active">
            <!-- Grade de 4 presets (2x2) -->
            <div class="preset-grid">
                <button class="preset-btn" onclick="applyPreset('preset1')">PRESET 1</button>
                <button class="preset-btn" onclick="applyPreset('preset2')">PRESET 2</button>
                <button class="preset-btn" onclick="applyPreset('preset3')">PRESET 3</button>
                <button class="preset-btn" onclick="applyPreset('preset4')">PRESET 4</button>
            </div>
        </div>
        
        <div id="preset-tab-save" class="preset-tab-content">
            <!-- Controles de salvamento -->
            <div class="save-controls">
                <select id="presetSelect" class="preset-select">
                    <option value="preset1">PRESET 1</option>
                    <option value="preset2">PRESET 2</option>
                    <option value="preset3">PRESET 3</option>
                    <option value="preset4">PRESET 4</option>
                </select>
                <button class="save-btn" onclick="saveCurrentPreset()">SALVAR PRESET</button>
            </div>
        </div>
        
        <div id="preset-tab-tools" class="preset-tab-content">
            <!-- Ferramentas -->
            <div class="tools-section">
                <button class="tool-btn reset-btn" onclick="applyPreset('cavePadrao')">PRESET PADRÃO</button>
                <button class="tool-btn debug-btn" onclick="toggleDebugLines()">MOSTRAR/OCULTAR LINHAS</button>
            </div>
        </div>
    </div>
    
    <!-- Sistema Modular -->
    <script src="modules/core.js"></script>
    <script src="modules/ui-controls.js"></script> 
    <script src="modules/presets.js"></script> 
    <script src="modules/debug-tools.js"></script>
    <script src="modules/uv-editor.js"></script> 
</body>
</html>